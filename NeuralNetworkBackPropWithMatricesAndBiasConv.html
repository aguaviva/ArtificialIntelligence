<!DOCTYPE html>
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Neural network back prop, with matrix fomulation</title>
<style type="text/css">
<!--
body { background-color:#ededed; font:norm2al 12px/18px Arial, Helvetica, sans-serif; }
h1 { display:block; width:800px; margin:20px auto; paddVing-bottom:20px; font:norm2al 24px/30px Georgia, "Times New Roman", Times, serif; color:#333; text-shadow: 1px 2px 3px #ccc; border-bottom:1px solid #cbcbcb; }
#container { width:800px; margin:0 auto; }
#myCanvas { background:#fff; border:1px solid #cbcbcb; }
#nav { display:block; width:100%; text-align:center; }
#nav li { display:block; font-weight:bold; line-height:21px; text-shadow:1px 1px 1px #fff; width:100px; height:21px; paddVing:5px; margin:0 10px; background:#e0e0e0; border:1px solid #ccc; -moz-border-radius:4px;-webkit-border-radius:4px; border-radius:4px; float:left; }
#nav li a { color:#000; display:block; text-decoration:none; width:100%; height:100%; }
-->
</style>
</head>
<script>
//---------------------------------------------------------------------

function RandomMat(inp,neurons)
{
    var L = []
    for(var i=0;i<neurons;i++)
    {
        L[i] = [];7
        for(var j=0;j<inp;j++)
        {
            L[i].push(2*Math.random()-1);
        }
    }
    return L;
}

function GetDimensions(m)
{
    o = []
    
    for(;;)
    {
        if (Array.isArray(m)==false)
            break;
            
        o.push(m.length);
        m=m[0];
    }
    return o;
}

function GetArrayDimensions(m)
{
    var mm=m;
    for(var i=0;i<5;i++)
    {
        if (Array.isArray(mm)==false) 
            return i;
        mm=mm[0]
    }
    
}

function PrintMat2D(m)
{
    var str = "<pre><table>";
    for(var j=0;j<m.length;j++)
    {
        str += "<tr><td>[</td>";
        for(var i=0;i<m[j].length;i++)
        {            
            str += "<td>" + m[j][i].toFixed(10) + "</td>";
        }
        str += "<td>]</td></tr>";
    }
    str += "</table></pre>";

    return str;
}

function PrintMat(mm)
{
    var d = GetDimensions(mm);
    var dim = d.length
    
    if (dim==2)
    {
        return PrintMat2D(mm)
    }
    else if (dim==3)
    {
        var str = ""
        for(var k=0; k<d[0];k++)
        {
            str += PrintMat(mm[k])
        }
    }    
    return str;
}

function RectangularMat(dimX, dimY)
{
    var O = [];
    for(var i=0;i<dimY;i++)
    {
        O[i] = Array(dimX).fill(0);
    }
    return O;
}

function MatId(dimX, value)
{
    var v = RectangularMat(dimX, dimX, value);
    
    for(var i=0;i<dimY;i++)
    {
        v[i][i]=value;
    }    
}

function MulMat(m1, m2)
{
    var O = [];
    for(var j=0;j<m1.length;j++)
    {
        O[j]=[];
        for(var i=0;i<m2[0].length;i++)
        {
            var tmp=0;
            for(var k=0;k<m1[0].length;k++)
            {                
                var v = (m1[j][k] * m2[k][i]);
                
                tmp += v;
            }
            O[j].push( tmp);
        }
    }
    return O;
}

function CheckMat(m, msg)
{
    var l = m[0].length;
    for(var j=0;j<m.length;j++)
    {
        if (l!=m[j].length)
            alert("caca");
            
        for(var i=0;i<m[j].length;i++)
        {
            if (typeof m[j][i] !="number")
            {
                console.log(msg+"\n "+  m[j][i]);        
                debugger;
            }
        }        
    }
}

function TransposeMat(m)
{
    var O = [];
    for(var j=0;j<m[0].length;j++)
    {
        O[j]=[];
        for(var i=0;i<m.length;i++)
        {
            O[j][i] = m[i][j];
        }
    }
    return O;
}

function AddMat(m1, m2)
{
    var O = [];
    for(var j=0;j<m1.length;j++)
    {
        O[j]=[];
        for(var i=0;i<m1[0].length;i++)
        {
            O[j][i] = m1[j][i] + m2[j][i];
        }
    }
    return O;
}

function SimpleMulMat(m1, m2)
{
    var O = [];
    for(var j=0;j<m1.length;j++)
    {
        O[j]=[];
        for(var i=0;i<m1[0].length;i++)
        {
            O[j][i] = m1[j][i] * m2[j][i];
        }
    }
    return O;
}

function MulKMat(k, m)
{
    var O = [];
    for(var j=0;j<m.length;j++)
    {
        O[j]=[];
        for(var i=0;i<m[0].length;i++)
        {
            O[j][i] = m[j][i] * k;
        }
    }
    return O;
}

function SubMat(m1, m2)
{
    var O = [];
    for(var j=0;j<m1.length;j++)
    {
        O[j]=[];
        for(var i=0;i<m1[0].length;i++)
        {
            O[j][i] = m1[j][i] - m2[j][i];
        }
    }
    return O;
}

function Square(v)
{
    return MulMat(v, TransposeMat(v))
}

function ConvertMat(m, x,y)
{
    var O = [];
    var n = 0;
    
    for(var j=0;j<y;j++)
        O[j]=[];
    
    for(var j=0;j<m.length;j++)
    {        
        for(var i=0;i<m[0].length;i++)
        {    
            O[Math.floor(n/x)][n % x] = m[j][i];
            n++;
        }    
    }
    
    return O;
}

//---------------------------------------------------------------------

function Act(x)
{
    return x;//1.0/(1.0+Math.exp(-x));
}

function DerAct(x)
{
    return 1;//Act(x)*(1-Act(x));
}

/*
function Act(x)
{
    return 1.0/(1.0+Math.exp(-x));
}

function DerAct(x)
{
    return Act(x)*(1-Act(x));
}
*/
/*
function Act(x)
{
    return Math.max(0,x);
}

function DerAct(x)
{
    return (x>0)?1:0;
}
*/
/*
//softplus 
function Act(x)
{
    return Math.log( 1 + Math.exp(x));
}

function DerAct(x)
{
    return 1.0/(1.0 + Math.exp(-x));
}
*/

//---------------------------------------------------------------------

function funcMat(func, m )
{
    var O = [];
    for(var j=0;j<m.length;j++)
    {
        O[j]=[];
        for(var i=0;i<m[0].length;i++)
        {
            O[j][i] = func(m[j][i]);
        }
    }
    return O;
}

//---------------------------------------------------------------------

class InputLayer
{
    constructor()
    {
        this.name ="Input";
    }

    forwardPass(input)
    {
        this.input = input
        return  input        
    }
}

//----------------------------------------------------------------

class QuadraticCostLayer
{
    constructor()
    {
        this.name ="Quadratic cost";
    }

    setValue(v)
    {
        this.value = v;
    }

    forwardPass(input)
    {
        
        var err = 0;
        
        this.diff = []
        
        this.diff = SubMat(input, this.value);
        
        var diff = this.diff;
        
        for(var j=0;j<diff[0].length;j++)
        {    
            for(var i=0;i<diff.length;i++)
            {
                err += diff[i][j] * diff[i][j];
            }
        }    
        
        return [[err]];        
    }

    getDerivative()
    {
        return MulKMat(2,this.diff)
    }

    backpropInput(output)
    {
    }
}

class QuadraticCostLayerFM
{
    constructor(fm)
    {
        this.fm = fm
        this.name ="Quadratic cost FM";
        this.layer = []
        for(var i=0;i<this.fm;i++)
            this.layer[i] = new QuadraticCostLayer()
    }

    setValue(v)
    {
        for(var i=0;i<this.fm;i++)
            this.layer[i].setValue(v[i])
    }

    forwardPass(input)
    {
        var err = 0;

        this.input = input;

        for(var i=0;i<this.fm;i++)
            err += this.layer[i].forwardPass(input[i])[0][0]
        
        return [[err]];        
    }

    getDerivative()
    {
        var out = [];
        
        for(var i=0;i<this.fm;i++)
            out[i] = this.layer[i].getDerivative()
        
        return out;
    }

    backpropInput(output)
    {
    }
}

class CrossEntropyQuadraticCostLayer
{
    constructor()
    {
        this.name ="Cross Entropy cost";        
    }

    setValue(v)
    {
        this.value = v;
    }

    forwardPass(input)
    {
        this.input = input;
        
        var err = 0;
        var n=0
        for(var j=0;j<input.length;j++)
        {    
            for(var i=0;i<input[0].length;i++)
            {
                var _i = this.value[i][j]
                var _o = input[i][j]                 
                
                err -= _i*Math.log(_o) + (1-_i)*Math.log(1-_o);
                n++;
            }
        }    

        return [[err/n]];                
    }

    getDerivative()
    {
        var num = SubMat(this.input, this.value);
        
        var deno = 0;        
        for(var j=0;j<this.input.length;j++)
        {    
            for(var i=0;i<this.input[0].length;i++)
            {
                var _o = this.input[i][j] 
                deno += (1.0-_o)*_o
            }
        }
        
        return MulKMat(1.0/deno,num);
    }

    backpropInput(output)
    {
    }
}

//----------------------------------------------------------------

function ReverseKernel1D(kernel)
{
    return kernel.slice().reverse();
}

function Add1DPaddingMat(input)
{
    var b = input.slice(0);
    b.unshift(Array(input[0].length).fill(0));
    b.push(Array(input[0].length).fill(0));
    return b;
}

function Conv1DInputForward(nonPaddedInput, weights, bias, padding)
{
    var input = Add1DPaddingMat(nonPaddedInput)

    out = []
    for(var y=0;y<input.length-weights.length+ padding;y++)
    {
        var o = bias;
        for(var i=0;i<weights.length;i++)
        {
            o+= input[y+i][0] * weights[i];
        }
        out[y]=[o];
    }
    return out;
}

//----------------------------------------------------------------

class Conv1D
{
    constructor()
    {
        this.weights = [.1,.2,-.3];
        this.bias = 0;
        this.padding = 1;
        this.name ="Conv1D";
    }

    forwardPass(input)
    {
        this.input = input;
        this.net = Conv1DInputForward(input, this.weights, this.bias, this.padding)
        return funcMat(Act, this.net)
    }

    getDerivative()
    {
        var revWeights =  ReverseKernel1D(this.weights);
        return Conv1DInputForward(this.layerDerivative, revWeights, 0, this.padding);
    }

    backpropInput(output)
    {
        this.layerDerivative  =  SimpleMulMat(funcMat(DerAct, this.net), output);

        var deltas = []
        for(var i=0;i<this.weights.length+1;i++)
        {
            deltas[i]=[]
        }

        var input = Add1DPaddingMat(this.input) 

        for(var y=0;y<input.length-this.weights.length+ this.padding;y++)
        {
            for(var j=0;j<this.weights.length;j++)
            {
                deltas[j][y] = input[y+j][0];
            }
            deltas[this.weights.length].push(1);
        }
        
        this.deltas = MulMat(deltas,this.layerDerivative);
    }

    train(LearningRate)
    {
        var weights = this.weights.slice(0);
        weights.push(this.bias);
        weights = [weights];
        var deltas = SubMat( weights, TransposeMat((MulKMat(LearningRate,this.deltas))));
        
        this.weights = deltas[0].slice(0,3);
        this.bias = deltas[0][3];
    }

    AddWeight(i,val)
    {
        if (i<this.weights.length)
            this.weights[i]+=val
        else
            this.bias+=val
    }

    numericalDerivarive(network, input)
    {
        var outA = []
        var outB = []
        for(var i=0;i<4;i++)
        {
            this.AddWeight(i,.0001)
            outA.push(ForwardPropagation(network, TransposeMat(input)))
            this.AddWeight(i,-.0001)
            outB.push(ForwardPropagation(network, TransposeMat(input)))
        }
        var out = MulKMat(1.0/.0001,SubMat(outA, outB));
        return out;
    }
}

//----------------------------------------------------------------

function ReverseKernel2D(kernel)
{
    var m = [];
    for(var j=0;j<kernel.length;j++)
        m[j] = ReverseKernel1D(kernel[kernel.length-1 - j]);
    return m;
}

function Add2DPaddingMat(input, padding)
{
    var b = [];
              
    for(var i=0;i<input.length;i++)
    {
        var l = input[i].slice(0);
        for(var j=0;j<padding;j++)
            l.unshift(0);
        for(var j=0;j<padding;j++)
            l.push(0);
        b[i+padding] = l;
    }
    
    for(var j=0;j<padding;j++)
        b[j] = Array(b[padding].length).fill(0);    
    for(var j=0;j<padding;j++)
        b[input.length+padding+j] = Array(b[padding].length).fill(0);
        
    return b;
}

function Conv2DInputForward(nonPaddedInput, weights, bias, padding)
{
    var input = Add2DPaddingMat(nonPaddedInput, padding)

    out = []

    for(var y=0;y<input.length - weights.length + 1; y++)
    {
        out[y]=[]
        for(var x=0;x<input[0].length - weights.length + 1; x++)
        {        
            var o = bias;
            for(var j=0;j<weights.length;j++)
            {
                for(var i=0;i<weights[0].length;i++)
                {
                    o += input[y+j][x+i] * weights[j][i];
                }
            }
            
            
            out[y].push(o);
        }
    }
    
    return out;
}

//----------------------------------------------------------------

class Conv2D
{
    constructor(weights, bias)
    {
        this.weights = weights[0][0];
        this.bias = bias;
        this.padding = 1;
        this.name ="Conv2D";
    }

    forwardPass(input)
    {
        this.input = input;
        this.net = Conv2DInputForward(input, this.weights, this.bias, this.padding)
        return funcMat(Act, this.net)
    }

    getDerivative()
    {        
        var revKernel = ReverseKernel2D(this.weights)
        return  Conv2DInputForward(this.layerDerivative, revKernel, 0, this.padding)
    }
    
    backpropInput(output)
    {
        this.layerDerivative = SimpleMulMat(funcMat(DerAct, this.net), output);

        var ld = [];
        
        for(var y=0;y<this.layerDerivative.length;y++)
        {
            for(var x=0;x<this.layerDerivative.length;x++)    
            {
                ld[x+y*this.layerDerivative.length] = [this.layerDerivative[y][x]];
            }
        }
        

        var deltas = []
        for(var i=0;i<this.weights.length*this.weights.length+1;i++)
        {
            deltas[i]=[]
        }

        var input = Add2DPaddingMat(this.input, this.padding)

        var xx = input.length-this.weights.length+ 1;
        var yy = input.length-this.weights.length+ 1;
        for(var y=0;y<yy;y++)
        {
            for(var x=0;x<xx;x++)    
            {
                for(var j=0;j<this.weights.length;j++)
                {
                    for(var i=0;i<this.weights.length;i++)    
                    {
                        deltas[i + j * this.weights.length][x + y * xx] = input[y+j][x+i];
                    }
                }
                deltas[this.weights.length*this.weights.length].push(1);
            }
        }
        
        var deltas = MulMat(deltas,ld);
        this.weightDeltas = ConvertMat(deltas.slice(0, 3*3), 3,3);
        this.biasDeltas   = deltas[deltas.length-1][0]
    }
        
    train(LearningRate)
    {
        this.weights = SubMat( this.weights, (MulKMat(LearningRate,this.weightDeltas)));
        this.bias    = this.bias - LearningRate * this.biasDeltas;
    }        
        
    AddWeight(i,val)
    {
        if (i<this.weights.length*this.weights.length)
            this.weights[Math.floor(i/3)][i%3]+=val
        else
            this.bias+=val
    }

    numericalDerivarive(network, input)
    {
        var outA = []
        var outB = []
        for(var i=0;i<3*3+1;i++)
        {
            this.AddWeight(i,.000001)
            outA.push(ForwardPropagation(network, (input)))
            this.AddWeight(i,-.000001)
            outB.push(ForwardPropagation(network, (input)))
        }
        var out = MulKMat(1.0/.000001,SubMat(outA, outB));
        
        return out;
    }
}

//----------------------------------------------------------------

class Conv3D
{
    constructor(weights, bias)
    {
        this.weights = weights[0];
        this.kernelDim = weights[0][0].length
        this.bias = bias;
        this.padding = (this.weights[0].length-1)/2;
        this.name ="Conv3D";
    }
    
    forwardPass(input)
    {
        this.input = input;
        this.fmIn = this.weights.length;
        
        this.net = Conv2DInputForward(input[0], this.weights[0], this.bias, this.padding)
        for(var k=1;k<this.fmIn;k++)
            this.net = AddMat(this.net, Conv2DInputForward(input[k], this.weights[k], 0, this.padding))
        
        return funcMat(Act, this.net)
    }
    
    getDerivative()
    {   
        var v = Conv2DInputForward(this.layerDerivative, ReverseKernel2D(this.weights[0]), this.bias, this.padding)
        for(var k=1;k<this.fmIn;k++)
            v = AddMat(v, Conv2DInputForward(this.layerDerivative, ReverseKernel2D(this.weights[k]), 0, this.padding));
        return  v;
    }
    
    backpropInput(output)
    {
        this.layerDerivative = SimpleMulMat(funcMat(DerAct, this.net), output);
        var ld = [];
        
        for(var y=0;y<this.layerDerivative.length;y++)
        {
            for(var x=0;x<this.layerDerivative[0].length;x++)    
            {
                ld[x+y*this.layerDerivative[0].length] = [this.layerDerivative[y][x]];
            }
        }
 
        var weights = this.weights[0];
 
        var deltas = []
        for(var i=0;i<this.fmIn*weights.length*weights[0].length+1;i++)
        {
            deltas[i]=[]
        }
        
        var input = [];
        for(var k=0;k<this.fmIn;k++)
        {
            input[k] = Add2DPaddingMat(this.input[k], this.padding)
        }        
        
        var yy = 1 + input[0].length - weights.length;
        var xx = 1 + input[0][0].length - weights[0].length;
        for(var y=0;y<yy;y++)
        {
            for(var x=0;x<xx;x++)
            {
                for(var k=0;k<this.fmIn;k++)
                {                                       
                    for(var j=0;j<weights.length;j++)
                    {
                        for(var i=0;i<weights[0].length;i++)    
                        {
                            deltas[i + j * weights[0].length + k* weights[0].length*weights.length][x + y * xx] = input[k][y+j][x+i];
                        }
                    }
                }
                deltas[this.fmIn*weights.length*weights[0].length].push(1);
            }
        }
        
        var deltas = MulMat(deltas,ld);
        this.weightDeltas = []
        for(var k=0;k<this.fmIn;k++)
            this.weightDeltas[k] = ConvertMat(deltas.slice(k*this.kernelDim*this.kernelDim, (k+1)*this.kernelDim*this.kernelDim), this.kernelDim,this.kernelDim);
        this.biasDeltas   = deltas[deltas.length-1][0]
    }
        
    train(LearningRate)
    {
        for(var k=0;k<this.fmIn;k++)
            this.weights[k] = SubMat( this.weights[k], MulKMat(LearningRate,this.weightDeltas[k]));
        this.bias    = this.bias - LearningRate * this.biasDeltas;
    }        
        
    AddWeight(i,val)
    {
        if (i<this.weights.length*this.weights[0].length*this.weights[1].length)
            this.weights[Math.floor(i/9)][Math.floor((i%9)/3)][(i%9)%3]+=val
        else
            this.bias+=val
    }
    numericalDerivarive(network, input)
    {
        var outA = []
        var outB = []
        for(var i=0;i<this.weights.length*this.weights[0].length*this.weights[1].length+1;i++)
        {
            this.AddWeight(i,.000001)
            outA.push(ForwardPropagation(network, (input)))
            this.AddWeight(i,-.000001)
            outB.push(ForwardPropagation(network, (input)))
        }
        var out = MulKMat(1.0/.000001,SubMat(outA, outB));
        
        return out;
    }
}

//----------------------------------------------------------------

class ConvFM
{
    constructor(weights, bias)
    {
        this.weights = weights;
        this.bias = bias;
        this.name ="ConvFM";
        this.net = []
        
        this.conv3D = []
        for(var k=0;k<this.weights.length;k++)
        {            
            this.conv3D[k] = new Conv3D([this.weights[k]], bias[k]);
            this.bias[k] = this.conv3D[k].bias
        }
    }
    
    forwardPass(input)
    {
        for(var k=0;k<this.conv3D.length;k++)
            this.net[k] = this.conv3D[k].forwardPass(input);
        
        return this.net;
    }
    
    getDerivative()
    {   
        var out = [];
        
        for(var k=0;k<this.conv3D.length;k++)
            out[k] = this.conv3D[k].getDerivative();

        return  out;
    }
    
    backpropInput(output)
    {
        this.weightDeltas = []
        this.biasDeltas = []
        for(var k=0;k<this.conv3D.length;k++)
        {
            this.conv3D[k].backpropInput(output[k]);
            this.weightDeltas[k] = this.conv3D[k].weightDeltas
            this.biasDeltas[k] = this.conv3D[k].biasDeltas
        }
    }
        
    train(LearningRate)
    {
        for(var k=0;k<this.conv3D.length;k++)
        {
            this.conv3D[k].train(LearningRate);
            this.bias[k] = this.conv3D[k].bias;
        }
    }        
        
    AddWeight(i,val)
    {
        var aaaa = this.weights[0][0][0].length;   
        var aaa = this.weights[0][0].length*aaaa;   
        var aa = this.weights[0].length*aaa;   
        var a = this.weights.length*aa;   
              
        var b = Math.floor(i/aa);
        var bb = i%aa;
        var c = Math.floor(bb/aaa);
        var cc = bb%aaa;
        var d = Math.floor(cc/aaaa);
        var dd = cc%aaaa;
        
        var t = this.weights.length*this.weights[0].length*this.weights[0][0].length*this.weights[0][0][0].length
        if (i<t)
            this.weights[b][c][d][dd]+=val
        else 
            this.conv3D[i-t].bias+=val;
    }
    numericalDerivarive(network, input)
    {
    
        var outA = []
        var outB = []
        for(var i=0;i<this.weights.length*this.weights[0].length*this.weights[0][0].length*this.weights[0][0][0].length+this.bias.length;i++)
        {
            this.AddWeight(i,.000001)
            outA.push(ForwardPropagation(network, (input)))
            this.AddWeight(i,-.000001)
            outB.push(ForwardPropagation(network, (input)))
        }
        var out = MulKMat(1.0/.000001,SubMat(outA, outB));
        
        return out;
    }
}

//----------------------------------------------------------------

class FullyConnected
{
    constructor(weights, bias)
    {
        this.name ="Fully";
        this.weights = weights
        this.bias = bias
    }

    forwardPass(input)
    {
        this.input = input;
        this.net = MulMat(input, this.weights )
        this.net = AddMat(this.bias, this.net)
        return funcMat(Act, this.net)        
    }

    getDerivative()
    {
        var t = TransposeMat(this.weights)
        return MulMat(this.layerDerivative, t);
    }

    backpropInput(output)
    {
        var sigmaDerNet = funcMat(DerAct, this.net);
        this.layerDerivative = SimpleMulMat(sigmaDerNet, output);
        
        // for training
        this.weightDeltas = MulMat(TransposeMat(this.input), this.layerDerivative);
        this.biasDeltas   = this.layerDerivative;
    }

    train(LearningRate)
    {
        this.weights = SubMat( this.weights, MulKMat(LearningRate,this.weightDeltas));
        this.bias    = SubMat( this.bias,    MulKMat(LearningRate,this.biasDeltas));
    }

    numericalDerivarive(network, input)
    {
        var out = []
        for(var j=0;j<this.weights.length;j++)
        {
            var vA = []
            var vB = []
            for(var i=0;i<this.weights[0].length;i++)
            {
                this.weights[j][i] += .0001
                vA.push(ForwardPropagation(network, input)[0])
                this.weights[j][i] -= .0001
                vB.push(ForwardPropagation(network, input)[0])
            }
            var c = MulKMat(1.0/.0001,TransposeMat(SubMat(vA, vB)));

            out.push(c)
        }

        for(var j=0;j<this.bias.length;j++)
        {
            var vA = []
            var vB = []
            for(var i=0;i<this.bias[0].length;i++)
            {
                this.bias[j][i] += .0001
                vA.push(ForwardPropagation(network, input)[0])
                this.bias[j][i] -= .0001
                vB.push(ForwardPropagation(network, input)[0])
            }
            var c = MulKMat(1.0/.0001,TransposeMat(SubMat(vA, vB)));

            out.push(c)
        }

        return out;
    }
}

//----------------------------------------------------------------

class MaxPool1D
{
    constructor()
    {
        this.name ="MaxPool 1D";
    }

    forwardPass(input)
    {
        this.o = Array(input.length/2).fill(0)
        this.index = Array(input.length/2).fill(0)
    
        this.errDer = [];
        for(var i=0;i<input.length/2;i++)
        {
            var a = input[i*2][0];
            var b = input[i*2 +1][0];
            this.o[i] = [Math.max(a,b)];
                        
            var row = Array(input.length).fill(0);
            if (a>b)
            {
                row[2*i] = 1;
            }
            else
            {
                row[2*i+1] = 1;
            }
            this.errDer.push(row);
        }
        
        this.input = input;
        return this.o;
    }

    getDerivative()
    {
        /*
        var out = [];
        for(var i=0;i<this.input.length/2;i++)
        {
            var row = Array(this.input.length).fill(0);
            
            var a = this.input[i*2][0];
            var b = this.input[i*2 +1][0];
            if (a>b)
            {
                row[2*i] = 1;
            }
            else
            {
                row[2*i+1] = 1;
            }
            
            out.push(row);
        }    
        */
        out = this.errDer;
        
        return MulMat(TransposeMat(out), this.layerDerivative);        
    }

    backpropInput(output)
    {
        this.layerDerivative  =  output;

        this.deltas = [];
    }

    train(LearningRate) {};
    
    numericalDerivarive(network, input)
    {
        return [];
    }
}

//----------------------------------------------------------------

class MidPool1D
{
    constructor()
    {
        this.name ="MidPool 1D";
    }

    forwardPass(input)
    {
        this.input = input;
        var o = Array(input.length/2).fill(0)
    
        for(var i=0;i<input.length/2;i++)
        {
            var a = input[i*2][0];
            var b = input[i*2 +1][0];
            o[i] = [(a+b)*0.5];     // average
        }
        
        return o;
    }

    getDerivative()
    {
        var out = [];

        var out = [];
        for(var j=0;j<this.layerDerivative.length;j++)
        {
            var row = [];
            for(var i=0;i<this.layerDerivative[0].length;i++)
            {
                var v = this.layerDerivative[j][i];
                out.push( [v*.5] );
                out.push( [v*.5] );
            }
        }        

        return out;
    }

    backpropInput(output)
    {
        this.layerDerivative  =  output;

        this.deltas = [];
    }
    
    train(LearningRate) {};

    numericalDerivarive(network, input)
    {
        return [];
    }
}

//----------------------------------------------------------------

class MidPool2D
{
    constructor()
    {
        this.name ="MidPool 2D";
    }

    forwardPass(input)
    {
        this.input = input;
        
        var o = []    
        for(var y=0;y<input.length/2;y++)
        {
            var row = [];
            for(var x=0;x<input[0].length/2;x++)
            {
                var a = input[y*2][x*2];
                var b = input[y*2][x*2+1];
                var c = input[y*2+1][x*2];
                var d = input[y*2+1][x*2+1];
                row[x] = (a+b+c+d)*0.25;     // average
            }
            o.push(row)
        }        
        return o;
    }

    getDerivative()
    {
        var out = [];

        for(var y=0;y<this.layerDerivative.length;y++)
        {
            var row1 = [];
            var row2 = [];

            for(var x=0;x<this.layerDerivative[0].length;x++)
            {
                var v = this.layerDerivative[y][x];
                
                row1.push(v*.25); row1.push(v*.25);
                row2.push(v*.25); row2.push(v*.25);
            }
            out.push(row1);
            out.push(row2);
        }    
                
        return out;        
    }

    train(LearningRate) {};

    backpropInput(output)
    {
        this.layerDerivative  =  output;

        this.deltas = [];
    }

    numericalDerivarive(network, input)
    {
        return [];
    }
}

//----------------------------------------------------------------

class MaxPool2D
{
    constructor()
    {
        this.name ="MaxPool 2D";
    }

    forwardPass(inputfms)
    {        
        this.inputfms = inputfms;
        
        this.errDer = [];
        var fmout = []
        
        for(var fm=0;fm<inputfms.length;fm++)
        {        
            var input = inputfms[fm];
        
            this.errDer[fm] = [];
        
            var o = []    
            
            for(var y=0;y<input.length/2;y++)
            {
                var row = [];
                var rowErrDer1 = [];
                var rowErrDer2 = [];
                for(var x=0;x<input[0].length/2;x++)
                {
                    var a = input[y*2  ][x*2];   var b = input[y*2  ][x*2+1];
                    var c = input[y*2+1][x*2];   var d = input[y*2+1][x*2+1];
                    
                    var res = Math.max(a,Math.max(b,Math.max(c,d)));
                    
                    row.push(res);
                    
                    var m = 0;
                    if (a==res) m++;
                    if (b==res) m++;
                    if (c==res) m++;
                    if (d==res) m++;
                    
                    m = 1.0/m;
                                    
                    rowErrDer1.push( (a==res)?m:0 ); rowErrDer1.push( (b==res)?m:0 );
                    rowErrDer2.push( (c==res)?m:0 ); rowErrDer2.push( (d==res)?m:0 );
                }
                
                o.push(row);
                
                this.errDer[fm].push(rowErrDer1);
                this.errDer[fm].push(rowErrDer2);
            }        
            fmout.push(o);
        }        
        return fmout;
    }

    getDerivative()
    {               
        return this.errDer;        
    }

    train(LearningRate) {};

    backpropInput(output)
    {
        this.layerDerivative  =  output;

        this.deltas = [];
    }

    numericalDerivarive(network, input)
    {
        return [];
    }
}

//----------------------------------------------------------------

class Flatten
{
    constructor(dimIni)
    {    
        this.dimIni = dimIni;
        this.name ="Flatten";
    }

    forwardPass(input)
    {        
        this.dim = GetDimensions(input)

        var row = []
   
        if (this.dim.length==2)
        {
            for(var y=0;y<this.dim[0];y++)
            {
                for(var x=0;x<this.dim[1];x++)
                {
                    row.push(input[y][x]);
                }
            }        
        }
        else if (this.dim.length==3)
        {
            for(var y=0;y<this.dim[1];y++)
            {
                for(var x=0;x<this.dim[2];x++)    
                {
                    for(var z=0;z<this.dim[0];z++)
                    {
                        row.push(input[z][y][x]);
                    }
                }
            }        
        }
        
        this.o = [row];
        
        return this.o;
    }

    getDerivative()
    {                       
        var input = this.layerDerivative[0];

        if (this.dim.length==2)
        {
            var column = [];            
            
            for(var y=0;y<this.dim[0];y++)    
            {
                var row = [];
                for(var x=0;x<this.dim[1];x++)    
                {
                    row.push(input[y*this.dim[1]+ x]);
                }
                column.push(row) 
            }        
            return column;
        }
        else if (this.dim.length==3)
        {
            var fm = [];

            // build dim3 matrix
            for(var z=0;z<this.dim[0];z++)
            {
                var column = [];            
                for(var y=0;y<this.dim[1];y++)
                {
                    var row = [];
                    column.push(row); 
                }
                fm.push(column) 
            }     
            var i = 0;
            
            for(var y=0;y<this.dim[1];y++)
            {
                for(var x=0;x<this.dim[2];x++)
                {
                    for(var z=0;z<this.dim[0];z++)
                    {
                        fm[z][y][x] = input[i++];
                    }
                }
            }   
            return fm;
        }
    }

    backpropInput(output)
    {
        this.layerDerivative  =  output;

        this.deltas = [];
    }

    train(LearningRate) {};
    
    numericalDerivarive(network, input)
    {
        return [];
    }
}

//----------------------------------------------------------------

function EvalNetwork(network, input)
{
    var res = input
    for(var i=0;i<network.length-1;i++)
    {
        res = network[i].forwardPass(res);
    }
    
    return res;
}

function ForwardPropagation(network, input)
{
    var res = input
    for(var i=0;i<network.length;i++)
    {
        res = network[i].forwardPass(res);
    }
    
    return res;
}

function BackwardPropagation(network)
{
    for(var i=network.length-2;i>0;i--)
    {
      network[i].backpropInput(network[i + 1].getDerivative());
    }
}

function ApplyDeltas(network, LearningRate)
{
    for(var i=1;i<network.length-1;i++)
    {
        network[i].train(LearningRate);
    }
}

function CalcError(network, input, output)
{
    var totalErr = 0;
    for(var i=0;i<input.length;i++)
    {
        var err = SubMat(ForwardPropagation(network, input[i]), output[i]);
        totalErr += MulMat(err, TransposeMat(err))[0][0];
    }
    return totalErr;
}

function SimpleTrain(network, input, output, LearningRate, epocsCount, iters)
{
    var t0 = performance.now();
    
    for(var l=0;l<iters;l++)
    {
        for(var epocs=0;epocs<epocsCount;epocs++)
        {
            for(var i=0;i<input.length;i++)
            {
                network[network.length-1].setValue(output[i]);
                
                ForwardPropagation(network, input[i])
                BackwardPropagation(network.getDerivative());
                
                ApplyDeltas(network, LearningRate);
            }
        }
    
        Print(CalcError(network, input, output).toFixed(4) + " : ");
        Print("  cost"+network[network.length-1].name+network[network.length-1].o + " : ");
        
        /*
        for(var i=0;i<input.length;i++)
            Print(PrintMat(ForwardPropagation(network, input[i])));
        */
        Print("<br>");
    }
    
    var t1 = performance.now();
    Print("time: " + (t1 - t0) + " milliseconds.<br>");
}



//--------------------------------------------------------------------

function Print(str)
{
    document.getElementById("text").innerHTML += str;
}

function PrintTensor(t)
{
    out = "";
    var dims = GetArrayDimensions(t)
    if (dims == 4)
    {
        for(var i=0;i<t.length;i++)
            for(var j=0;j<t[i].length;j++)
                out += PrintMat(t[i][j]);            
    }
    else if (dims == 3)
    {
        for(var i=0;i<t.length;i++)
            out += PrintMat(t[i]);            
    }
    else if (dims == 2)
    {
        out += PrintMat(t);            
    }
    else if (dims == 1)
    {
        out += "[" + t.join(",") + "]";            
    }
    else if (dims == 0)
    {
        out += t;            
    }
    else
    {
    out += "none"
    }
    return out;
}
   
function DumpWeights(network, input)
{    
    var res = input
    
    for(var i=0;i<network.length;i++)
    {
        var n = network[i];
        
        res = n.forwardPass(res);
    
        out = ""
        out +="<table>";
        ////////
        out +="<tr>";
        out +="<td>name</td>";
        if (n.weights!=undefined)
            out +="<td>weights</td>";
        if (n.bias!=undefined)
            out +="<td>bias</td>";
        out +="<td>output</td>";        
        out +="</tr>";
        ////////
        out +="<tr>";
        out +="<td>"+n.name+"</td>";
        if (n.weights!=undefined)
        {
            out += "<td>" + PrintTensor(n.weights) + "</td>";            
        }
        
        if (n.bias!=undefined)
            out += "<td>" + PrintTensor(n.bias) + "</td>";            
            
        out += "<td>" + PrintTensor(res) + "</td>";        
        out +="<tr>";
            
        out +="</table>";
        ////////
        Print(out)
    }
}

function TestNetwork(network, input, output)
{
    network[network.length-1].setValue(output);

    ForwardPropagation(network, input)
    for(var i=1;i<network.length-1;i++)
    {
        Print("<pre>"+i+") Forward pass: "+network[i].name+"</pre>");
    }

    Print("<pre>---------------------------------</pre>");

    var str = "<table><tr><td>analytical</td><td>numerical</td></tr><tr><td>";

    BackwardPropagation(network);

    for(var i=1;i<network.length-1;i++)
    {
        str += "<pre>"+i+" '" + network[i].name + "'</pre>";
        str += "<pre>weights: "+PrintTensor(network[i].weightDeltas)+"</pre>";
        str += "<pre>bias: "+network[i].biasDeltas+"</pre>";
    }

    str += "</td><td>";

    //numerical derivative
    for(var i=1;i<network.length-1;i++)
    {
        str += "<pre>"+i+" '" + network[i].name + "'</pre>";
        var c = network[i].numericalDerivarive(network, input);
        str += "<pre>"+PrintMat(c)+"</pre>";
    }

    str += "</tr></table>";

    Print(str);
}

function TestResult(name, network, input, output, expected)
{
    for(var i=0;i<3;i++)
    {
        network[network.length-1].setValue(output);
        ForwardPropagation(network, input);
        //DumpWeights(network, input);
        BackwardPropagation(network);
        ApplyDeltas(network, 0.01);
    }

    var res = ForwardPropagation(network, input)
    var out = name + " " + (res[0] - expected) + "</br>";        
    Print(out)    
}

function DebugResult(name, network, input, output, expected)
{

    for(var i=0;i<3;i++)
    {
        network[network.length-1].setValue(output);
        ForwardPropagation(network, input);
        DumpWeights(network, input);
        BackwardPropagation(network);
        ApplyDeltas(network, 0.01);
    }

    var res = ForwardPropagation(network, input)
    var out = name + " " + (res[0] - expected) + "</br>";        
    Print(out)    
    
    
    TestNetwork(network, input, output)
}

//-----------------------------------------------

// 
function Train_Conv2D_TF_flatten(exec) //OK
{
    var input = [
        [0.0,0.0,0.0],
        [0.0,0.0,0.0],
        [0.0,0.0,1.0],
    ];

    var output = 
    [
        [0, 0, 0, 0, 0, 0, 0, 0, 0] 
    ];

    var weights1 = 
    [
        [
            [
                [-0.35148391, -0.54286993, -0.15596440],
                [-0.28157371, 0.33377141, 0.14396811],
                [-0.51350635, 0.15021497, 0.23279625]
            ]
        ]
    ];        
    var bias1 = 0;

    var weights2 = 
    [
        [
            [
                [-0.21956453, -0.23107162, 0.51478815],
                [0.14524263, -0.44979829, -0.33712912],
                [0.50630438, -0.25503239, -0.35768771]
            ]
        ]
    ];        
    var bias2 = 0;

    var network = []

    network.push(new InputLayer());
    network.push(new Conv2D(weights1, bias1));
    network.push(new Conv2D(weights2, bias1));
    network.push(new Flatten());
    network.push(new FullyConnected(9, 9));
    network.push(new QuadraticCostLayer());

    
    network[4].weights = 
    [
    [ -0.08573127, -0.16425127, -0.54901135, 0.06758583, 0.47192514, -0.21393749, -0.28238392, -0.40925634, 0.27883804],
    [ -0.53457123, 0.01826918, -0.02993470, -0.22540590, 0.52443874, 0.28334349, 0.25656074, -0.29099262, 0.55590653],
    [ -0.24533775, 0.52350068, 0.04525167, 0.09061265, -0.20033002, 0.35536075, -0.40188044, -0.45447621, -0.12332788],
    [ 0.55475223, -0.49247038, 0.45353591, -0.36980018, -0.04583657, -0.48260644, -0.07797119, 0.13794118, -0.53099024],
    [ -0.07356733, -0.01144814, 0.11955363, -0.36568359, 0.29693240, -0.42368466, 0.51152718, 0.04899001, -0.24182010],
    [ 0.05065227, 0.08040857, 0.24223125, -0.53683448, -0.57640970, 0.51478565, -0.34516090, 0.33958453, -0.43691564],
    [ 0.25506723, -0.39482057, -0.12762260, 0.43259323, 0.21203119, 0.23655814, 0.17958766, -0.19454509, -0.28696179],
    [ -0.46890286, 0.30476266, -0.31136882, 0.02323657, -0.48311877, 0.00574541, -0.02332687, -0.43135071, 0.43734920],
    [ -0.45905861, -0.06109834, -0.28408998, 0.08311009, -0.36424071, -0.36448342, 0.25489324, -0.11887363, 0.05339730]
    ]
    network[4].bias = [[0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000]]


    exec("Train_Conv2D_TF_flatten", network, input, output, 0.11206103)
}


function Train_Conv3D_TF_flatten(exec) //OK
{
    var input = 
    [
        [
            [ 0.0, 0.0, 0.0 ],  
            [ 0.0, 0.0, 0.0 ],
            [ 10.0, 0.0, 0.0 ]
        ]
    ]

    var output = 
    [
        [0, 0, 0, 0, 0, 0, 0, 0, 0] 
    ];

    var weights1 = 
    [
        [
            [
                [-0.28698543, -0.12734440, 0.27252319],
                [-0.41927618, 0.19007733, 0.32225546],
                [0.23131493, 0.30565342, 0.00299084]
            ],
        ],
        [
            [
                [-0.44325143, -0.22990398, 0.11754945],
                [0.12265000, 0.23213407, 0.16681591],
                [0.20926765, -0.18148276, 0.16017523]
            ]
        ]
    ];        
    var bias1 = [0, 0];

    var network = []

    network.push(new InputLayer());
    network.push(new ConvFM(weights1, bias1));
    network.push(new Flatten());
    network.push(new FullyConnected(18, 1));
    network.push(new QuadraticCostLayer());

    network[3].weights = 
    [
        [ -0.45376259],
        [ 0.09868270],
        [ 0.03431302],
        [ 0.55708176],
        [ -0.37370881],
        [ 0.30513626],
        [ -0.41597337],
        [ 0.37906116],
        [ -0.04915863],
        [ -0.32559404],
        [ 0.24390608],
        [ -0.18292832],
        [ 0.26886290],
        [ -0.42239088],
        [ -0.03970891],
        [ 0.38676578],
        [ -0.03815687],
        [ -0.20058471]
    ]
    network[3].bias = [[0.00000]]


    exec("Train_Conv3D_TF_flatten", network, input, output,  0.11162803)
}



function Train_Conv2D_LY_1_FM_1_TF(exec) //OK
{
    var input = [
        [0.0,2.0,1.0],
        [0.0,0.0,0.0],
        [3.0,0.0,0.0],
    ];

    var output = [
        [0.0,2.0,0.0],
        [0.0,0.0,0.0],
        [4.0,0.0,0.0],
    ];

    weights = 
    [
        [
            [
                [-0.3514839, -0.5428699, -0.1559644], 
                [-0.2815737, 0.3337714, 0.1439681], 
                [-0.51350635, 0.15021497, 0.23279625]
            ]
        ]
    ]
    var bias = 0;
    
    var network = []
    network.push(new InputLayer());
    network.push(new Conv2D(weights, bias));
    network.push(new QuadraticCostLayer());

    exec("Train_Conv2D_LY_1_FM_1_TF", network, input, output, 3.6741004)
}

function Train_Conv2D_LY_2_FM_1_TF(exec) // OK
{
    var input = [
        [0.1,0.2,0.3],
        [0.4,0.5,0.6],
        [0.7,0.8,0.9],
    ];

    var output = [
        [0.0,2.0,0.0],
        [0.0,0.0,0.0],
        [4.0,0.0,0.0],
    ];

    var weights1 = 
    [
        [
            [
                [-0.3514839, -0.5428699, -0.1559644], 
                [-0.2815737, 0.3337714, 0.1439681], 
                [-0.51350635, 0.15021497, 0.23279625]
            ]
        ]
    ];
    var bias1 = 0;

    var weights2 = 
    [
        [
            [
                [-0.21956453, -0.23107162, 0.51478815], 
                [0.14524263, -0.4497983, -0.33712912], 
                [0.5063044, -0.2550324, -0.3576877]
            ]
        ]
    ];
    var bias2 = 0;    

    var network = []
    network.push(new InputLayer());
    network.push(new Conv2D(weights1, bias1));
    network.push(new Conv2D(weights2, bias2));
    network.push(new QuadraticCostLayer());

    exec("Train_Conv2D_LY_2_FM_1_TF", network, input, output,  15.311142)
}

function Train_Conv2D_LY_1_FM_21_TF(exec) //OK
{
    var input = 
    [
        [
            [ 0.0, 0.0, 0.0 ],  
            [ 0.0, 0.0, 0.0 ],
            [ 1.0, 0.0, 0.0 ]
        ]
        ,
        [
            [ 0.0,0.0,0.0 ],  
            [ 0.0,0.0,0.0 ],
            [ 1.0,0.0,0.0 ]
        ]
    ]
    
    var output  = 
    [
        [
            [ 0.0,0.0,0.0 ],  
            [ 0.0,0.0,0.0 ],
            [ 0.0,0.0,0.0 ]
        ]
    ]

    var weights = 
    [
        [
            [
                [-0.28698543, -0.1273444, 0.2725232],
                [-0.41927618, 0.19007733, 0.32225546],
                [0.23131493, 0.30565342, 0.0029908419]
            ],      
            [
                [-0.44325143, -0.22990398, 0.11754945],
                [0.12265, 0.23213407, 0.1668159],
                [0.20926765, -0.18148276, 0.16017523]
            ]
        ]
    ]

    var bias = [0];
    
    var network = []
    network.push(new InputLayer());
    network.push(new ConvFM(weights, bias));
    network.push(new QuadraticCostLayerFM(1));

    exec("Train_Conv2D_LY_1_FM_21_TF", network, input, output,  0.3434204)
}

function Train_Conv2D_LY_1_3x4_FM_21_TF(exec) //OK
{
    var input = 
    [
        [
            [ 0.0, 0.0, 0.0 ],  
            [ 0.0, 0.0, 0.0 ],
            [ 0.0, 0.0, 0.0 ],
            [ 1.0, 0.0, 0.0 ]
        ]
        ,
        [
            [ 0.0, 0.0, 0.0 ],  
            [ 0.0, 0.0, 0.0 ],
            [ 0.0, 0.0, 0.0 ],
            [ 1.0, 0.0, 0.0 ]
        ]
    ]
    
    var output  = 
    [
        [
            [ 0.0, 0.0, 0.0 ],  
            [ 0.0, 0.0, 0.0 ],
            [ 0.0, 0.0, 0.0 ],
            [ 0.0, 0.0, 0.0 ]
        ]
    ]
    var weights = 
    [
        [
            [
                [-0.28698543, -0.1273444, 0.2725232],
                [-0.41927618, 0.19007733, 0.32225546],
                [0.23131493, 0.30565342, 0.0029908419]
            ],      
            [
                [-0.44325143, -0.22990398, 0.11754945],
                [0.12265, 0.23213407, 0.1668159],
                [0.20926765, -0.18148276, 0.16017523]
            ]
        ]
    ]

    var bias = [0]
            
    var network = []
    network.push(new InputLayer());
    network.push(new ConvFM(weights, bias));
    network.push(new QuadraticCostLayerFM(1));

    exec("Train_Conv2D_LY_1_3x4_FM_21_TF", network, input, output, 0.3476254)
}



function Train_Conv2D_LY_1_FM_12_TF(exec) //WIP
{
    var input = 
    [
        [
            [ 0.0, 0.0, 0.0 ],  
            [ 0.0, 0.0, 0.0 ],
            [ 1.0, 0.0, 0.0 ]
        ]
    ]
    
    var output  = 
    [
        [
            [ 0.0, 0.0, 0.0 ],  
            [ 0.0, 0.0, 0.0 ],
            [ 4.0, 0.0, 0.0 ]
        ],
        [
            [ 0.0, 0.0, 0.0 ],  
            [ 0.0, 0.0, 0.0 ],
            [ 0.0, 0.0, 0.0 ]
        ]
    ]

    var weights = 
    [
        [
            [
                [-0.28698543, -0.1273444, 0.2725232],
                [-0.41927618, 0.19007733, 0.32225546],
                [0.23131493, 0.30565342, 0.0029908419]
            ]
        ],
        [
            [
                [-0.44325143, -0.22990398, 0.11754945],
                [0.12265, 0.23213407, 0.1668159],
                [0.20926765, -0.18148276, 0.16017523]
            ]
        ]
    ]
    
    var bias = [0,0]
    
    var network = []
    network.push(new InputLayer());
    network.push(new ConvFM(weights, bias));
    network.push(new QuadraticCostLayerFM(bias.length));

    exec("Train_Conv2D_LY_1_FM_12_TF ", network, input, output, 12.326438)
}

function Train_Conv2D_LY_1_FM_22_TF(exec) 
{
    var input = 
    [
        [
            [ 0.0, 0.0, 0.0 ],  
            [ 0.0, 0.0, 0.0 ],
            [ 1.0, 0.0, 0.0 ]
        ]
        ,
        [
            [ 0.0,0.0,0.0 ],  
            [ 0.0,0.0,0.0 ],
            [ 1.0,0.0,0.0 ]
        ]
    ]
    
    var output  = 
    [
        [
            [ 0.0,0.0,0.0 ],  
            [ 0.0,0.0,0.0 ],
            [ 0.0,0.0,0.0 ]
        ]
        ,
        [
            [ 0.0,0.0,0.0 ],  
            [ 0.0,0.0,0.0 ],
            [ 0.0,0.0,0.0 ]
        ]
    ]

    var weights = 
    [
        [
            [
                [-0.24853668, 0.23601204, 0.16461182],
                [0.2003246, 0.0025901496, -0.23138984],
                [0.3304258, 0.36111665, 0.21520424]
            ],
            [
                [-0.110283494, -0.36310384, 0.27908146],
                [0.26470363, -0.25222933, -0.37095994],
                [-0.3085345, -0.08485702, 0.062185228]
            ]
        ],
        [
            [
                [-0.38386703, 0.10180086, 0.20103401],
                [0.18123108, 0.1387158, 0.026846379],
                [-0.1349195, -0.2095514, -0.36210072]
            ]
            ,
            [
                [-0.1991027, 0.10621804, 0.14446682],
                [-0.15716869, -0.20142771, -0.38632715],
                [0.1900627, 0.25583363, 0.17615098]
            ]        
        ]
    ]
    
    var bias = [0,0]
            
    var network = []
    network.push(new InputLayer());
    network.push(new ConvFM(weights, bias));
    network.push(new QuadraticCostLayerFM(bias.length));

    exec("Train_Conv2D_LY_1_FM_22_TF  ", network, input, output, 0.2694685)
}

function Train_Conv2D_LY_2_FM_22_TF(exec) //TBD
{
    var input = 
    [
        [
            [ 0.0, 0.0, 0.0 ],  
            [ 0.0, 0.0, 0.0 ],
            [ 1.0, 0.0, 0.0 ]
        ]
        ,
        [
            [ 0.0,0.0,0.0 ],  
            [ 0.0,0.0,0.0 ],
            [ 1.0,0.0,0.0 ]
        ]
    ]
    
    var output  = 
    [
        [
            [ 0.0,0.0,0.0 ],  
            [ 0.0,0.0,0.0 ],
            [ 0.0,0.0,0.0 ]
        ]
        ,
        [
            [ 0.0,0.0,0.0 ],  
            [ 0.0,0.0,0.0 ],
            [ 0.0,0.0,0.0 ]
        ]
    ]

    var weights1 = 
    [
        [
            [
                [-0.24853668, 0.23601204, 0.16461182],
                [0.2003246, 0.0025901496, -0.23138984],
                [0.3304258, 0.36111665, 0.21520424]
            ],
            [
                [-0.110283494, -0.36310384, 0.27908146],
                [0.26470363, -0.25222933, -0.37095994],
                [-0.3085345, -0.08485702, 0.062185228]
            ]
        ],
        [
            [
                [-0.38386703, 0.10180086, 0.20103401],
                [0.18123108, 0.1387158, 0.026846379],
                [-0.1349195, -0.2095514, -0.36210072]
            ]
            ,
            [
                [-0.1991027, 0.10621804, 0.14446682],
                [-0.15716869, -0.20142771, -0.38632715],
                [0.1900627, 0.25583363, 0.17615098]
            ]        
        ]
    ]
    
    var bias1 = [0,0]

    var weights2 = 
    [
      [
        [
          [-0.15525559, -0.31805542, -0.25292343],
          [-0.096146315, 0.39462566, 0.31136644],
          [0.2612375, 0.21004963, -0.33643344]
        ],
        [
          [0.3640102, 0.3580113, -0.0412772],
          [0.22741032, 0.12494832, -0.12899187],
          [0.25656343, -0.18626979, 0.07626253]
        ]
      ],
      [
        [
          [-0.16339232, -0.2383863, -0.019867033],
          [0.30715847, -0.335023, -0.07884577],
          [-0.026148677, -0.37653136, -0.16448177]
        ],
        [
          [0.10270202, -0.18033515, -0.2645669],
          [0.2218042, -0.31572, -0.24623677],
          [-0.04008466, 0.06674394, 0.16911077]
        ]
      ]
    ]
    
    var bias2 = [0,0]

            
    var network = []
    network.push(new InputLayer());
    network.push(new ConvFM(weights1, bias1));
    network.push(new ConvFM(weights2, bias2));
    network.push(new QuadraticCostLayerFM(bias2.length));
    
    exec("Train_Conv2D_LY_2_FM_22_TF  ", network, input, output, 0.1269055)
}


function Train_Conv2D_LY_2_FM_24_TF(exec) //TBD
{
    var input = 
    [
        [
            [ 0.0, 0.0, 0.0 ],  
            [ 0.0, 0.0, 0.0 ],
            [ 1.0, 0.0, 0.0 ]
        ]
        ,
        [
            [ 0.0,0.0,0.0 ],  
            [ 0.0,0.0,0.0 ],
            [ 1.0,0.0,0.0 ]
        ]
    ]
    
    var output  = 
    [
        [
            [ 0.0,0.0,0.0 ],  
            [ 0.0,0.0,0.0 ],
            [ 0.0,0.0,0.0 ]
        ]
        ,
        [
            [ 0.0,0.0,0.0 ],  
            [ 0.0,0.0,0.0 ],
            [ 0.0,0.0,0.0 ]
        ]
        ,
        [
            [ 0.0,0.0,0.0 ],  
            [ 0.0,0.0,0.0 ],
            [ 0.0,0.0,0.0 ]
        ]
        ,
        [
            [ 0.0,0.0,0.0 ],  
            [ 0.0,0.0,0.0 ],
            [ 0.0,0.0,0.0 ]
        ]
    ]

    var weights1 = 
[
  [
    [
      [-0.24853668, 0.23601204, 0.16461182],
      [0.2003246, 0.0025901496, -0.23138984],
      [0.3304258, 0.36111665, 0.21520424]
    ],
    [
      [-0.38386703, 0.10180086, 0.20103401],
      [0.18123108, 0.1387158, 0.026846379],
      [-0.1349195, -0.2095514, -0.36210072]
    ]
  ],
  [
    [
      [-0.110283494, -0.36310384, 0.27908146],
      [0.26470363, -0.25222933, -0.37095994],
      [-0.3085345, -0.08485702, 0.062185228]
    ],
    [
      [-0.1991027, 0.10621804, 0.14446682],
      [-0.15716869, -0.20142771, -0.38632715],
      [0.1900627, 0.25583363, 0.17615098]
    ]
  ]
]
    
    var bias1 = [0,0]

    var weights2 = 
[
  [
    [
      [-0.12676565, -0.20651111, 0.32221046],
      [0.21329954, -0.27469677, 0.24681988],
      [-0.0866445, -0.25587958, 0.078116745]
    ],
    [
      [-0.13340926, -0.016221374, -0.27354512],
      [-0.021350294, -0.1342988, 0.20327982],
      [-0.042877346, -0.26390076, -0.16465561]
    ],
    [
      [0.2972131, -0.0337027, 0.102019876],
      [0.20948318, 0.062268108, -0.23811468],
      [0.05638823, -0.24370313, 0.011695623]
    ],
    [
      [0.08385587, -0.21601796, -0.2577843],
      [-0.032729, 0.13807836, 0.20011196],
      [0.22134534, -0.027920634, -0.022440761]
    ]
  ],
  [
    [
      [-0.25969118, -0.07850313, 0.25422964],
      [0.17150483, -0.21029234, -0.23762648],
      [0.055344105, -0.179319, -0.046913385]
    ],
    [
      [-0.19464159, 0.25079384, -0.06437731],
      [-0.30743656, 0.0930357, -0.1765934],
      [0.049745083, -0.105486244, -0.13695924]
    ],
    [
      [0.29231504, 0.18567976, -0.10532141],
      [-0.15208864, -0.102319956, 0.13592282],
      [0.30280116, -0.23696908, -0.17300963]
    ],
    [
      [-0.14724302, 0.18110237, -0.20105147],
      [0.0544962, -0.11648576, -0.10330105],
      [-0.10764448, -0.021621704, 0.18419734]
    ]
  ]
]
    
    var bias2 = [0,0]

            
    var network = []
    network.push(new InputLayer());
    network.push(new ConvFM(weights1, bias1));
    network.push(new ConvFM(weights2, bias2));
    network.push(new QuadraticCostLayerFM(bias2.length));
    
    exec("Train_Conv2D_LY_2_FM_24_TF  ", network, input, output, 0.1269055)
}


function Train_Conv2D_LY_1_3x4_FM_22_TF(exec) //WIP
{
    var input = 
    [
        [
            [ 0.0, 0.0, 0.0 ],  
            [ 0.0, 0.0, 0.0 ],
            [ 0.0, 0.0, 0.0 ],
            [ 1.0, 0.0, 0.0 ]
        ]
        ,
        [
            [ 0.0, 0.0, 0.0 ],  
            [ 0.0, 0.0, 0.0 ],
            [ 0.0, 0.0, 0.0 ],
            [ 1.0, 0.0, 0.0 ]
        ]
    ]
    
    var output  = 
    [
        [
            [ 0.0, 0.0, 0.0 ],  
            [ 0.0, 0.0, 0.0 ],
            [ 0.0, 0.0, 0.0 ],
            [ 0.0, 0.0, 0.0 ]
        ]
        ,
        [
            [ 0.0, 0.0, 0.0 ],  
            [ 0.0, 0.0, 0.0 ],
            [ 0.0, 0.0, 0.0 ],
            [ 0.0, 0.0, 0.0 ]
        ]
    ]
    weights = 
    [
        [
            [
                [-0.24853668, 0.23601204, 0.16461182],
                [0.2003246, 0.0025901496, -0.23138984],
                [0.3304258, 0.36111665, 0.21520424]
            ],
            [
                [-0.110283494, -0.36310384, 0.27908146],
                [0.26470363, -0.25222933, -0.37095994],
                [-0.3085345, -0.08485702, 0.062185228]
            ]
        ],
        [
            [
                [-0.38386703, 0.10180086, 0.20103401],
                [0.18123108, 0.1387158, 0.026846379],
                [-0.1349195, -0.2095514, -0.36210072]
            ]
            ,
            [
                [-0.1991027, 0.10621804, 0.14446682],
                [-0.15716869, -0.20142771, -0.38632715],
                [0.1900627, 0.25583363, 0.17615098]
            ]        
        ]
    ]

    bias = [0,0]
            
    var network = []
    network.push(new InputLayer());
    network.push(new ConvFM(weights, bias));
    network.push(new QuadraticCostLayerFM(bias.length));
    
    exec("Train_Conv2D_LY_1_3x4_FM_22_TF", network, input, output, 0.2718303)
}

function MNIST_conv_TF(exec)
{
var input = 
[
    [
        [ 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000],
        [ 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000],
        [ 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000],
        [ 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.46666670, 0.98823535, 0.99607849, 1.00000000, 1.00000000, 0.99607849, 0.44313729, 0.00000000, 0.00000000],
        [ 0.00000000, 0.00000000, 0.00000000, 0.02352941, 0.95294124, 0.99607849, 0.99607849, 0.63529414, 0.10196079, 0.02352941, 0.63137257, 0.99607849, 0.00000000, 0.00000000],
        [ 0.00000000, 0.00000000, 0.00000000, 0.99607849, 0.99607849, 0.69411767, 0.00000000, 0.00000000, 0.00000000, 0.00784314, 0.45098042, 0.99607849, 0.00000000, 0.00000000],
        [ 0.00000000, 0.00000000, 0.81568635, 0.99607849, 0.54901963, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.56078434, 0.99607849, 0.62745100, 0.00000000, 0.00000000],
        [ 0.00000000, 0.00000000, 0.99607849, 0.99607849, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.16862746, 0.99607849, 0.99607849, 0.00000000, 0.00000000, 0.00000000],
        [ 0.00000000, 0.00000000, 0.99607849, 0.59215689, 0.00000000, 0.00000000, 0.00000000, 0.49411768, 0.99607849, 0.99607849, 0.83529419, 0.00000000, 0.00000000, 0.00000000],
        [ 0.00000000, 0.00000000, 0.99607849, 0.99607849, 0.99607849, 0.99607849, 0.99607849, 0.99215692, 0.83921576, 0.99607849, 0.57647061, 0.00000000, 0.00000000, 0.00000000],
        [ 0.00000000, 0.00000000, 0.03137255, 0.67843139, 0.99607849, 0.99607849, 0.18039216, 0.00000000, 0.96470594, 0.99607849, 0.00000000, 0.00000000, 0.00000000, 0.00000000],
        [ 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.03529412, 0.99607849, 0.85882360, 0.00000000, 0.00000000, 0.00000000, 0.00000000],
        [ 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.33725491, 0.99607849, 0.03137255, 0.00000000, 0.00000000, 0.00000000, 0.00000000],
        [ 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000]
    ]
]

var output = 

[
    [ 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 0.00000000, 1.00000000]
]


    var weights1 = 
[
    [
        [
            [-0.40044,  1.39251,  1.53509,  -1.20184,  -1.55040],
            [-0.62751,  0.20638,  -0.53980,  -0.45992,  0.14141],
            [1.92555,  -0.26546,  -1.80504,  0.77679,  0.58408],
            [0.42258,  0.43382,  -1.56110,  0.53515,  0.18111],
            [0.48405,  -0.52786,  0.41783,  -0.35236,  -0.11114]
        ],
    ],
    [
        [
            [1.06921,  -0.41600,  -0.32442,  1.90319,  0.09681],
            [0.37812,  -0.42673,  0.30186,  0.61579,  0.10396],
            [0.03390,  -0.14569,  -0.76626,  -1.78096,  -0.30402],
            [0.21798,  -0.46208,  -0.17149,  0.01994,  0.21012],
            [-0.15265,  -0.11330,  -1.63646,  1.13742,  1.31164]
        ],
    ],
]

var bias1 = [0.71189, 1.58872]

var weights2  = [
    [
        [
            [-0.21253,  0.42346,  1.05266,  -1.11682,  0.77978],
            [1.24528,  -1.05662,  -0.13420,  -0.35908,  0.27172],
            [0.80576,  0.93288,  0.97077,  0.02445,  -0.20353],
            [-1.83189,  -0.85819,  0.89789,  1.58243,  -0.46141],
            [0.29915,  0.56829,  0.76399,  0.82440,  0.44823]
        ],
        [
            [0.59263,  0.12394,  -1.74323,  0.82959,  0.03310],
            [1.22515,  -1.68569,  1.28581,  0.68728,  0.30339],
            [-2.15054,  -0.32811,  -1.81053,  -0.72351,  1.37678],
            [0.12505,  1.03898,  -1.00298,  2.91721,  -0.32537],
            [0.76973,  1.22873,  0.54991,  0.32304,  0.02203]
        ],
    ],
    [
        [
            [0.47261,  -1.39564,  -0.81977,  0.93270,  0.94153],
            [0.43713,  0.09899,  0.07707,  0.50910,  0.28982],
            [-0.72349,  0.27979,  -1.31227,  -0.89159,  1.63672],
            [-0.62262,  0.55606,  0.18373,  2.00508,  -0.61324],
            [0.69664,  -0.62457,  1.28411,  0.51960,  3.58637]
        ],
        [
            [0.51206,  0.49640,  -1.91397,  -0.99781,  0.19240],
            [0.02753,  1.30252,  -1.09193,  0.58976,  -1.51840],
            [-0.30882,  -1.15378,  -0.72172,  0.29369,  0.25240],
            [0.90591,  2.49991,  -0.43388,  -0.11716,  -0.90106],
            [1.00581,  0.04707,  0.17609,  -0.12853,  0.46790]
        ],
    ],
    [
        [
            [-0.43042,  0.45048,  0.84290,  -1.48758,  1.47855],
            [-0.14358,  -0.79734,  -0.54108,  0.34818,  0.72317],
            [0.19683,  -0.49714,  0.36272,  0.93128,  0.13842],
            [-0.85840,  -0.07827,  -1.29910,  -1.05924,  -0.13553],
            [0.77993,  -0.60416,  0.98801,  -1.36127,  -0.81186]
        ],
        [
            [-1.44619,  1.96150,  1.01238,  -0.13701,  0.01661],
            [1.82762,  -0.57203,  1.10328,  -0.20185,  -0.56359],
            [0.80637,  -0.14306,  -0.30568,  -0.42391,  0.31624],
            [-2.07605,  -1.60495,  -0.67492,  -0.16840,  0.76779],
            [-0.27340,  0.34756,  -0.30202,  0.03786,  1.08143]
        ],
    ],
    [
        [
            [0.58410,  -2.02763,  -1.20968,  1.02016,  2.65138],
            [-0.93449,  1.68586,  0.34427,  1.59252,  -0.46187],
            [-0.97065,  0.14126,  0.81998,  -1.51217,  1.26373],
            [-0.91608,  0.25145,  0.39670,  0.28039,  -2.16603],
            [-0.28558,  0.82963,  -0.64108,  -0.43019,  0.07660]
        ],
        [
            [0.88816,  -0.91018,  0.85836,  0.55229,  0.51040],
            [1.00976,  -0.05195,  1.07958,  0.02160,  -0.05430],
            [0.50141,  0.42364,  -0.30996,  1.57292,  -1.80462],
            [-0.76050,  0.40869,  -0.09754,  -0.69483,  -1.68390],
            [-0.62668,  0.41328,  -0.36225,  0.49896,  0.37636]
        ],
    ],
]

var bias2 = [0.47189, -0.12622, 1.39904, -1.33928]

var weights3 = 
[
    [ -1.13401973, -1.84265256, -0.03064941, 1.12552977, -1.87319517, 0.25456214, -1.72422540, 1.05321407],
    [ 1.21397829, 0.30925417, 0.69616950, -0.42504030, 0.54683053, 0.55252963, -1.02779806, 0.69028407],
    [ 1.11298037, -0.53684354, 0.31816998, -0.16887626, -1.19110608, -1.16537619, -0.03497484, -0.54839665],
    [ -0.77038699, -0.60365957, 0.28293613, 0.12578556, 0.04713179, 1.37589717, 0.24950211, 0.21999928],
    [ -0.94476807, -0.90940756, 2.28482223, -0.83962286, -1.64663124, -0.56565130, -0.36521029, -0.53995198],
    [ -0.26169208, -1.11776018, 0.19805147, -0.67276049, 1.78451145, 0.36655879, -0.78566688, -0.01102698],
    [ 1.34858513, 0.98590481, -0.84976572, 0.42081609, -0.38757980, 0.32309037, -0.16866326, 0.21077751],
    [ 1.91555834, 0.93901652, -1.32499838, -1.19110155, -0.44705835, -1.65657401, 0.16874252, -0.40481466],
    [ 2.24605370, 0.00110705, 0.23366912, -0.69409037, -0.33963546, -0.11703120, -1.04711246, 1.04424918],
    [ -0.37120885, 1.04707503, 0.58650172, -0.44472989, -0.43186575, -0.99436104, 0.65820688, 0.04186225],
    [ -0.06444775, -0.13275722, -1.21511519, 0.19116855, -0.36085701, 1.36606610, -1.27618909, 0.87200630],
    [ -0.71459508, -0.38716093, -0.08741935, -0.30531120, -0.05725628, -0.69165063, 1.42430401, -0.84891510],
    [ 0.00869966, -0.71888041, 0.92837822, 0.66117191, 2.56033635, -0.26569751, -1.54307842, 0.56513852],
    [ 0.41368616, 0.06103966, 0.29272234, 0.35650185, 1.55777085, -0.33775529, 1.35425830, -0.13817257],
    [ 1.11378133, 2.70059299, 1.16188979, -2.77591848, -0.34929281, -0.22189079, 0.28283188, 0.72704279],
    [ -0.79397678, 1.14769077, 0.20957717, 1.32813799, -0.87138408, 0.79745054, -0.80288756, -0.39468840],
    [ 0.55148900, -0.25687486, 0.02982436, 1.71169960, 0.21349356, 1.20669043, 1.19540024, 0.59099358],
    [ -0.86230111, -1.08010149, -1.43010473, -0.81538612, -0.67307025, -0.34663606, 0.13411848, -0.03043752],
    [ -1.46575212, -0.11567159, -0.97426808, -0.43612054, -0.49559829, 1.32156670, -0.83272892, 0.36870986],
    [ -2.53294897, 0.41468894, -1.40306139, 0.99242783, -0.13992539, -0.49976802, 0.99052989, 0.20799738],
    [ 0.25625136, 0.63146484, 0.23041441, 0.71025646, 0.76491195, 0.68083525, -1.22886264, 0.32117674],
    [ 1.18919361, 0.11372045, 0.11732993, -0.39146689, -0.41571894, -0.30868575, -0.17062104, 0.08394183],
    [ -0.46778962, -0.16002868, 1.31537580, 1.49214292, 2.54365945, -1.05378795, -0.16356176, 0.91717583],
    [ 1.93337452, 0.16749318, -0.83252221, 0.98423994, -0.46202016, 1.00071025, -2.52494025, 1.59521139],
    [ 0.21976416, -0.12786724, 1.44824123, -0.84860605, 1.48019731, -0.87141669, 0.07424930, 0.87434685],
    [ 0.45749840, -1.04695845, 0.88310611, 0.29364601, -0.23781215, 0.73560524, 0.70014602, -0.38162297],
    [ 0.45704135, -0.22564487, 0.89588302, 1.79771912, 0.01041545, -0.43964657, 0.43944225, -0.33685330],
    [ -1.38531303, 0.16516179, -1.60299170, 1.13780689, -1.03658903, 0.53508407, -0.26307207, -0.11234559],
    [ -0.39583740, 1.27753472, -0.18850929, -1.88519847, 0.75022423, -1.41713488, -2.05582023, -0.22761171],
    [ 1.04101634, -0.82704496, -1.94660079, -1.57910061, -0.00509476, 0.16295038, 0.11992680, -0.76700139],
    [ -1.85219765, -1.28390062, -0.72814584, -0.62389255, 1.22322154, 1.25424814, -0.46124062, -1.09664667],
    [ 0.60310423, -1.85890353, -0.01420890, 2.35712171, -0.98400646, 0.09269414, -1.23292005, -0.35117081],
    [ -0.69183189, -0.44524130, -0.44193086, 0.03055496, -0.73104787, 0.48161986, -2.32384968, 0.70562637],
    [ -0.66355175, -0.25564948, -0.65153062, 0.53271741, -0.66302741, 1.32081831, 1.34714711, 1.19855416],
    [ 0.74784917, 1.91357970, -0.92720193, -0.65042758, -1.42993426, 0.71580303, -0.65375823, 1.52606285],
    [ -0.71190679, -0.02721106, 1.49496353, -0.11422656, -0.50503987, 0.65109462, -1.71952617, 0.40907922],
    [ 1.56153107, 0.43204448, 2.26070881, 0.01246456, 0.25470981, -0.32883853, 0.27531168, -1.17854190],
    [ 0.63271886, -0.62623960, 0.61919510, 0.13518722, -0.39929113, 0.52001101, 1.23511088, -1.58523440],
    [ -1.08053029, -1.19152629, -0.47172230, 0.93741572, 0.29526106, -0.18830144, -0.17566837, 1.65449011],
    [ 0.50505573, 0.53185731, 1.22731292, 0.91634041, -0.01191076, 0.30479515, -0.94063103, 0.26500130],
    [ 0.29661512, -2.80079484, -0.89015257, 0.24555060, 0.59161562, 0.42332193, 0.38134795, -0.90144652],
    [ -1.13132620, 1.13502729, -0.02751807, -0.41666657, 1.50868785, -1.21327758, 0.84751016, 0.97574025],
    [ 0.19374648, -0.80380410, 0.45119396, 0.55864465, -1.50607908, 0.01780318, 1.72630203, -0.12755552],
    [ -0.26270097, 0.28228855, 0.31964853, 0.00683220, -1.22257364, 1.25717485, -0.53814405, -0.48004019],
    [ 1.65954709, -0.43088934, 0.71972269, 1.37605631, -0.06850464, -0.31837550, -0.36990413, 0.06457791],
    [ 0.67859316, -1.28820539, 0.59546226, 0.79548889, 2.08617878, -0.45171419, -0.25893500, -0.37125701],
    [ 1.48016882, -1.41215312, -0.01446677, -1.38607204, 0.76325500, 0.08847430, 1.10642290, -2.19238210],
    [ -0.58497787, 1.54469001, -0.32280320, 0.77445656, 1.51594770, 0.09502081, 1.27203143, 0.82954890],
    [ -2.27334237, -0.02233897, 0.70010000, 1.65439045, -1.25389588, 1.22230875, 0.90465653, -0.93994766],
    [ -0.30930701, 0.27724791, 0.67427772, 0.31593025, 1.52144063, -0.28422171, -1.21874344, -1.03860331],
    [ 1.18946862, 0.51739198, -1.17394876, 0.04423422, 0.62859905, 1.29008663, -0.24916831, 1.49630880],
    [ -0.50519031, 0.32681352, -1.15133238, 1.74504435, -0.61940587, -0.05920080, -0.84800428, 1.20774436],
    [ 0.77990270, 1.45102298, 0.58272707, 1.27156460, -0.68150842, 0.82015330, -0.28147224, -0.09834969],
    [ -1.00357139, -1.56539690, 0.37213627, -1.16730940, 0.72251981, 0.03946884, 0.66753083, -0.73359525],
    [ 0.74358976, -0.15786204, -0.51330364, 0.84336936, 0.92198086, -0.65775001, -1.08524525, 0.73534060],
    [ -1.42968380, -0.80441916, 1.55970252, 0.63656062, -0.31113628, 0.29720840, 0.48668405, -0.73096597],
    [ 1.29965353, 1.02245927, -1.79763365, -0.35730705, 1.12967813, -0.47029710, 0.82579941, -0.87049377],
    [ -1.51254511, -0.97959030, -0.78355634, -0.62337929, -1.57243466, 0.16415811, 0.30161351, -0.54372746],
    [ 0.93731761, 0.40828067, 0.60259777, 0.11183254, -1.41572165, 2.90520048, 0.62802547, 1.74802399],
    [ -0.69866234, -0.17615743, -0.20823051, -1.49653852, 0.35106188, -0.52069378, -0.05100700, -1.72952259],
    [ 1.82980776, 0.28909495, 0.23700236, -1.19973671, -0.37035912, -1.26684511, -0.78943771, -0.09174903],
    [ -1.87721372, -0.21085407, -1.12826276, -0.28574720, 1.50410128, 1.12375522, -0.28940031, -0.08436868],
    [ -0.33182448, 0.27443221, -2.79957843, -0.91955793, -0.66105396, -0.55575114, -0.71112555, -0.46103799],
    [ 0.00574171, -0.87978953, -0.71639919, 0.44053975, -0.31652591, 0.22539103, -1.75129056, 0.86720163],
    [ 0.55547541, 0.40286067, 0.29165620, 0.08941107, 1.60478044, -0.17383705, 1.21449411, -0.35843602],
    [ 0.39763713, -0.73456985, 0.81347156, 1.77213955, 0.60147691, 0.69369811, -0.30216843, 0.30143553],
    [ 1.06697214, -0.11581615, -0.54974222, 0.91621643, -1.05069339, 0.98525602, 1.16026270, 0.66629231],
    [ 0.20416678, 1.57541072, 0.60209876, -0.33402014, -1.08097541, 0.25460327, -0.68877941, -1.15555632],
    [ 0.84898627, -1.57611036, -0.79170167, -0.68293059, -0.18570392, -0.00583545, -0.80481470, -1.42064488],
    [ 0.25943848, 1.78769350, 0.01723554, 0.14344528, 0.66848391, -0.46965000, 0.05755035, -0.04997826],
    [ -0.16244604, -1.03787172, 0.84944689, -0.72221738, 0.00398007, 1.12985814, -0.37465176, 1.48290658],
    [ 0.20598672, 0.37412778, 1.84796488, 1.28322661, 0.07454889, -0.19927475, 0.87573856, 0.02907213],
    [ 1.99855363, 0.22194469, 0.45244357, -0.69275439, 1.45129812, -0.97774374, 1.47560072, -1.69229937],
    [ 0.44605067, -0.52734619, 0.52392793, -0.12922078, 1.03611958, 0.56816661, 0.68402505, 1.16275823],
    [ 0.24161504, -0.62583417, 1.60634351, -1.06449699, 1.66917074, -1.18674707, 2.32108426, -0.37922144],
    [ -1.08966815, -1.19718802, -1.10358691, 0.42486048, -0.46217790, -1.41112983, 0.27163529, -0.56148887],
    [ -0.76917082, -0.47404444, -0.18110712, 0.74136490, -0.10694985, -0.13362306, 1.05462611, 1.64939690],
    [ -1.48125041, -0.63786739, -0.36117554, -1.56813610, -2.35278678, -0.67351407, -0.66004401, 1.33341026],
    [ -0.72111589, -2.50870037, -1.06515908, 0.62886190, -0.51414526, -0.22320993, 0.60365832, -0.86252475],
    [ 3.01895761, -1.24203455, 2.00186729, -0.81365424, 0.74838632, 0.34794959, 0.06426041, 0.47338149],
    [ 0.11764313, -0.30104646, 1.65549099, 1.39383733, -0.59041727, -2.51472688, 0.61023068, 0.78635168],
    [ 1.51916397, 0.64114523, -0.86004198, 0.26012024, -0.35775557, 0.28126180, 0.74726087, -0.69889027],
    [ 1.68746698, -2.18952942, -0.95877475, 0.34479871, -0.59515309, 0.29920608, 0.44771916, -0.03956595],
    [ 1.77299786, 1.83181560, 0.86465877, 1.58566833, 0.15996623, -0.71304882, 0.46692529, 0.56701964],
    [ -1.36371624, 0.53616267, 0.42489716, 2.00098324, 1.94600379, 0.43441063, -1.15866768, -0.55878448],
    [ -0.06875236, -0.85000879, -2.81342983, 0.17491318, -0.42547402, 0.66599417, 1.62817192, 0.75895846],
    [ 0.42228165, -2.51901817, -0.30334163, 0.16324133, -0.12699348, -0.22260229, 1.87331772, 1.09055614],
    [ 1.70910192, -0.24999772, 0.50989729, 0.84600914, 0.88181514, -0.45496303, -0.64123964, -0.77852815],
    [ -0.68780315, 1.38041437, 1.70275557, -0.36123571, 0.47235891, 0.87093049, 0.75008702, -0.97804987],
    [ 0.28984129, -0.76664126, 1.63787186, 0.82455987, -1.74085426, 0.76013643, 1.51959789, -0.81039482],
    [ -0.64347166, -1.11350024, -1.57606936, 0.27305210, 0.78133267, -0.46604297, 0.55313027, -1.48400271],
    [ 0.46555501, 1.04513431, -0.24280180, -0.73944294, 0.11180041, -1.48246062, 0.22151378, -0.85616922],
    [ -0.22250679, 0.82486689, 1.19427764, 0.51267493, 0.19206136, 0.69380832, 0.92349088, 0.92374545],
    [ 0.83669811, 0.34508732, 0.68257380, 0.64757359, -0.12890162, 0.02613046, 0.73424554, -1.28702807],
    [ -0.13690910, 0.98620784, -0.05601859, 0.35835102, 0.71200228, -0.01539340, 0.01802754, -1.29929566],
    [ -2.06410837, -0.64355880, 1.75127208, -0.37327230, -0.62549764, -1.45576298, -0.44000325, 0.72828555],
    [ -0.84011525, 1.20657253, -0.81814295, 1.73800957, -0.00415279, -0.67114615, -0.26479504, 1.09565926],
    [ 0.52049327, 0.79215956, 0.73444206, -0.64228851, -1.23698974, 1.57124245, -1.41158938, 2.30095220],
    [ 0.08418107, 0.40243542, -0.64105332, 0.80300182, -0.42678231, -0.23617783, -0.86823738, -0.65252864],
    [ -0.79856026, -0.38587943, -1.16982555, -1.70579481, -1.31108582, -0.75833070, -0.81253624, 0.00723385],
    [ 0.40036261, -0.07875147, -0.25363633, -0.42941472, -0.64087921, -0.51680309, 0.21210001, 0.06679497],
    [ -2.68067622, -0.92938238, -0.71537781, -1.01587331, -1.13220859, 0.64552242, -0.23917829, -0.13687651],
    [ 2.22827601, 0.99013203, -0.57824957, -0.42052600, -0.23043294, 0.22625861, -0.58466917, 0.34094781],
    [ 0.15937996, -1.01061726, -1.70070362, -1.22986841, 0.87507331, 0.84641844, 2.66737843, 0.44878367],
    [ 1.65239871, 0.91462147, 0.38890588, -0.06644621, -0.42994869, -0.68307620, 0.92935240, -0.02793586],
    [ -0.07219203, -0.80540431, 0.58035326, -0.50074506, 1.44655740, -0.07199560, -1.71088934, 1.07592392],
    [ 1.64912462, 1.43134880, 1.64225924, -1.12290323, -0.68962801, 0.99303275, 0.11733599, -0.37361285],
    [ 0.13325347, -0.71857721, 0.08527359, 1.08172822, 0.25128159, -0.41955003, 0.64875507, -0.54495609],
    [ -0.25644812, -0.13137856, -1.41582584, -0.35575494, -0.41789788, 0.43592969, 0.68253583, -0.00057870],
    [ -1.29578602, 0.46958038, -0.85787749, -1.31120574, -0.60873842, -0.43727690, -0.69367719, -1.18681943],
    [ 0.09794019, -3.17145061, 1.17507517, 0.83118373, -1.00866282, -1.03007722, 0.39350075, -0.73907101],
    [ 1.28173339, -0.83876991, -2.31966305, -1.07639682, -1.74252629, 1.49697578, 1.61867356, -0.54381627],
    [ -0.29033709, -0.51172364, -3.12102270, 0.30115700, -0.97630203, -1.32463396, -1.48327661, -1.34590042],
    [ 2.20568633, -0.60423005, 0.32953376, -0.56063449, -0.96992207, -0.46577576, -0.43369615, -1.10840189],
    [ 0.33454260, 1.15907669, 0.08444475, -0.55667382, -1.40266085, -0.33719277, 1.73732769, 0.91462582],
    [ -0.38104510, 0.63942283, -1.04277933, -0.10370980, 0.73076552, -1.19873428, -0.20067269, 1.70447242],
    [ -1.90943635, 3.82924724, 1.32795441, 1.33659625, 0.06874476, -0.04073003, 0.25759327, 0.20022678],
    [ 0.68790215, -0.33814725, -1.27822638, 1.25889194, 0.64734739, 1.37466359, -0.96717435, 0.11430761],
    [ 0.61716771, 2.60872102, -0.42326212, -0.71399432, 0.56062067, 0.77232355, -0.21342130, -0.65829659],
    [ -0.28277043, -0.01124675, -0.99881107, -0.25413093, 1.77095652, 0.03709098, -0.25522017, -0.32165405],
    [ -0.07603341, 1.43896163, -0.05888283, 0.16802891, 0.25968477, -0.11541907, -0.65059686, -0.45212051],
    [ -1.70104468, -0.03277902, -1.65513229, -0.81316984, -1.62973094, -1.58119118, -0.95616573, 0.18814512],
    [ 0.14129362, -0.55575192, -0.18055382, -0.78708422, 0.72018915, 0.82963324, -0.39825252, 0.65048754],
    [ -0.32957622, -0.41977763, 0.88817960, -0.13225490, 1.13070095, -0.04148168, -0.20758094, 0.18945117],
    [ 0.57175851, -0.08281012, -1.21152747, -0.60969609, 0.59093344, 1.02946532, 0.65894610, -0.58073217],
    [ 0.42802086, 1.24853182, 1.06410551, 0.00839134, -0.18781629, -0.32862073, 0.44467440, -0.07196187],
    [ -0.86737317, -0.59739220, -1.11663711, -0.80331254, -1.14511669, -0.69493359, -0.59831321, 0.28249931],
    [ 0.15285143, -0.41011670, 1.33930123, 0.67420536, 0.59953684, 0.01343994, -1.30048692, 1.97771132],
    [ 0.49577531, -0.23961972, 0.28225130, 1.21756637, -0.98609972, 0.27352121, -1.40151536, -0.84674048],
    [ 0.34043178, 0.36822677, 0.50232220, -0.81328493, 1.33809435, -0.08480050, 0.37713557, 0.21338059],
    [ 0.26998198, 1.26070070, -0.30650437, -0.50418574, 0.86016607, 1.22839785, 0.39624038, 0.58915520],
    [ -0.69512367, -0.26407665, -0.61858708, 0.78318942, 1.19111490, -1.56266046, -1.32776248, 0.41163149],
    [ -0.90515351, -1.64534891, -0.64627802, 0.61971778, 1.41237009, 1.29304361, -0.31273443, -1.41191041],
    [ -0.57912862, -1.36051977, 1.01935709, 0.58975482, -1.08969402, 0.00425250, 0.30915892, -1.11948252],
    [ -1.21109831, 0.42497876, -1.28375876, -0.67150164, -0.43293142, -0.47459531, 0.75971419, 0.15713708],
    [ -1.23131418, 0.31025484, 0.64348924, -0.92447442, -1.69732213, -0.06894074, 1.27345753, 0.11890006],
    [ 0.36048153, 0.64173794, -0.06868994, -0.32437351, -0.72810692, -0.63294309, -0.28484893, -0.14076555],
    [ 1.22224176, -0.58446568, -0.18212208, -0.55708963, -0.06078833, 1.38767910, -1.83677542, 0.18184280],
    [ -0.10066211, 0.48685661, 0.88810045, -0.62665284, -0.47530344, -0.59828478, 1.11870039, 0.46191105],
    [ 0.17371264, 0.63812310, 0.92194790, -0.85666591, -0.20543547, 0.32249457, 0.85817903, 0.79326731],
    [ -1.86706054, -0.91285747, 0.09581026, -0.08050490, 0.22039521, 2.63014746, 1.13766682, -0.87301898],
    [ -1.26328218, -1.68794775, -0.77931368, 0.38358951, -1.89235759, 0.96942550, 0.44709289, 2.37104011],
    [ 0.94591331, -0.80333608, -1.22418022, 1.52090764, 0.90544671, 1.28079379, -0.31840172, 0.35299933],
    [ 0.60227484, 0.37946907, -1.39632523, -1.13698065, 1.36870325, -1.47061312, -0.12964863, 0.99233568],
    [ 1.22721243, -0.08181565, 1.00633013, 0.29256180, 0.89385015, 0.74351704, -1.11428213, -0.67891616],
    [ 1.71149731, -0.87925988, -0.71229273, -0.00077575, 1.94123578, 0.56480044, 0.55301464, -0.19137776],
    [ -0.89615887, -1.05369961, -0.39178169, 0.08041372, -1.82624602, 0.54992354, -0.64175493, -0.25513652],
    [ -0.31966212, 0.32506400, -0.77904266, -0.98504376, -0.21698031, 0.89135349, 1.42808259, -1.35272264],
    [ 0.16587569, 2.40644503, -2.05776906, -0.00206348, 0.56283897, 1.44264293, 1.84963500, 0.49844643],
    [ 0.44123149, 0.50724894, -1.97628987, -0.21617590, 0.44305107, 0.75339681, -0.71696246, -0.71700764],
    [ -0.61047322, 1.44554806, 0.68446499, 0.48849958, -1.43007851, 1.88712597, 0.39174515, 1.54441559],
    [ -1.41337216, 0.43382409, 0.29255620, 2.16404867, 0.38343117, -0.03962668, 0.39434865, -0.41590190],
    [ -0.48491198, 0.34662578, 1.31494308, 2.16574383, 1.54936588, 0.15549874, -0.63355702, 0.64001971],
    [ -1.82613254, 1.10627508, 1.43150413, 2.56271935, 0.25752440, -1.51323533, -0.88842851, 2.62393570],
    [ -0.64086109, 0.11238362, 1.22665215, 0.64121437, -0.57553542, -1.65228820, -1.91062009, -0.06632131],
    [ 0.42593515, 1.07470620, -0.33664256, 0.96886766, -0.84603179, -0.71927005, 1.06421864, 1.19544291],
    [ 0.90174502, -0.47076431, 0.10763258, -0.46588799, 0.52280676, -0.72251487, -0.76286310, -0.66871727],
    [ -1.89931142, 0.78671885, -0.96093959, -1.05634737, -1.29688680, 0.88020724, -2.45927882, -0.64429557],
    [ -0.14554632, 0.31186786, 0.15842843, 0.86827546, -0.72907907, -0.34811640, 3.48030162, -0.12982908],
    [ 0.92328542, 0.71118027, 1.43375659, 0.11477401, -0.23124920, 0.74431103, 0.88149625, -0.71078658],
    [ -0.14464779, 1.15812767, 0.43183434, -1.44665909, -0.14814508, -0.74824268, 0.08520626, -1.23364151],
    [ 0.92252123, 0.85024351, 0.30511451, 0.53782248, 0.37462473, -0.52839410, 0.33189750, 0.43059158],
    [ 0.29922172, -0.64014179, 0.68166798, 0.22552344, 0.29293045, 0.96293801, -2.26025009, 0.32844460],
    [ -0.08873637, -0.16462813, -0.44598398, -0.65155697, 0.63447762, -2.24351549, -1.38412821, -0.63854992],
    [ 0.34487605, 0.41241029, -0.34399465, -0.03371947, 0.71714228, 2.17469716, -0.16073723, 0.52886868],
    [ 0.63719851, 0.12973072, 0.02650139, 1.18690884, -0.61539525, 1.52752304, -0.70583409, -0.40955150],
    [ 1.10441971, 1.28770816, -0.98059630, 0.09470804, 0.39468244, 1.94594908, -0.12658145, -0.01735221],
    [ 0.03830960, -1.53524268, 1.73578024, -0.65897411, -0.00790460, -1.26096904, 0.10302818, 2.75559568],
    [ -0.43388566, -0.90480334, 1.46594739, -0.18683097, -0.75231880, -0.87692291, -0.26187649, 1.29573476],
    [ -0.42429391, 0.98429722, -0.56246835, -1.08017468, 2.57869220, -0.08141176, -0.43873441, -0.44247234],
    [ 0.25953695, 1.25640190, 0.16620032, -1.18454325, 0.89411587, -0.66032177, -2.11834311, 0.72690010],
    [ 0.80350572, 0.79249692, -0.73014355, 0.27812871, -0.69091070, -0.67283279, 0.58011842, 0.72520578],
    [ -0.09584995, -1.29272950, 1.42816246, 0.08160934, -0.68796527, 0.28534755, 0.64068252, 0.27628201],
    [ 0.97268242, -0.76784158, -0.79942536, -1.09423220, 0.37529480, -0.00776569, 1.18931389, 0.11420742],
    [ 0.17565560, -0.71087474, 1.39080322, -0.62163174, -0.34184420, -0.39853942, -2.74653292, -0.37122041],
    [ -0.48194653, 0.41499272, 0.57196701, -0.78365582, -0.09154914, -0.02894687, 1.46626079, -1.04159927],
    [ -0.51989603, 0.51319230, 1.30644894, -0.31313959, -1.64403117, 1.23224986, -0.17198773, -0.47912961],
    [ -0.32751429, 0.13589318, 0.49086487, -0.50098664, 0.31228343, 0.77768934, -1.94900918, 2.14965844],
    [ -1.81027961, -0.63244963, -0.30500922, 1.28082550, -1.16076374, -1.72741854, 0.63861859, 1.34973550],
    [ 0.99191117, -0.88923645, -0.07907321, 0.19745091, -0.36108437, 1.00917280, -0.63691896, 0.61839378],
    [ 1.63192129, -1.14954972, 2.11476493, -0.81036228, -0.00032265, -0.28321254, -1.26225579, 0.43699741],
    [ 1.16197467, -0.86660087, -0.43871075, -1.60108709, 0.94525433, -0.06649937, 0.86385661, 0.96002573],
    [ 0.55138296, 1.34675932, -0.41737658, 1.38876605, -0.09782492, -1.40778959, 0.58342791, 0.79752797],
    [ 0.00298369, -2.06386304, 1.15022492, -0.27034256, -0.32276240, 1.95317006, -0.44375417, 1.63862467],
    [ 1.12822056, -1.05287993, 0.22348270, -0.18478549, -0.11879586, 0.37832671, -0.56331092, -1.38690150],
    [ 0.90145969, -0.10106647, -2.64352012, -0.86573803, -0.97566170, 0.59607637, -0.60576653, -0.28717372],
    [ -0.81612480, -1.02022791, 0.78606570, 0.91194791, -0.50199020, -0.28445932, 0.53450018, 1.30425513],
    [ 0.55212808, -0.62784767, 0.42688131, -0.74037313, -1.77079129, 0.95778221, 2.18987560, -0.00674313],
    [ 0.98526919, 0.62203270, -0.24932580, -1.54820275, -0.72973406, 0.57133204, 0.64207834, 1.96305966],
    [ -1.15300918, -2.97000170, 0.78600812, -0.00615528, -0.14336778, -0.28068271, 1.28863096, -0.99463463],
    [ -0.51007420, -1.36580980, 0.50189167, -1.49583733, -1.57887697, -0.83621275, 0.17449582, 0.46333402],
    [ 1.89021027, 1.88436091, 1.15641725, 0.46648735, -2.52461481, 2.36514473, 0.28470105, -1.13496721],
    [ 0.70562458, 0.77652270, 0.89392126, 1.39295375, -0.49231988, 0.38114586, 0.48311689, 1.21400225],
    [ 1.19319069, -0.66719407, -0.55675751, -0.29688722, -0.69870466, -1.07700121, -0.96670508, 1.34676623],
    [ -0.84357816, -1.09199953, 1.27423978, 0.56597060, 1.48868835, -1.08407104, -0.31937242, 1.66639030],
    [ -1.50311422, 0.00003944, -1.58413625, 0.10389634, 0.28960338, 1.15975440, 0.34557402, 0.96180421]
]


var bias3 = 
[[1.36428, -0.36533, -1.23183, 0.44870, 0.08801, -1.09067, -0.75490, 0.26077]]

  
var weights4 = 
[
    [ -0.10245068, -0.42229936, 0.53483063, -0.90609199, 0.22863060, 1.33724499, 0.54341757, -0.11454915, -0.13848655, 0.70253915],
    [ 0.18164249, -0.91935599, 1.01541901, -0.56042647, 0.84225386, 0.46027097, -0.19229612, -0.20362997, 1.54061270, -2.90275311],
    [ 0.42875922, -0.97401637, 2.47610259, 1.14033699, 1.64593983, -0.27449429, 0.16148353, 0.46592373, 1.37861192, 0.87806231],
    [ 0.33405796, -1.46100056, -0.37598357, 1.60502279, 0.91579366, 1.64982653, 1.19729781, -1.08322680, 1.14369559, -0.36785260],
    [ -0.08016754, 0.01282061, 0.35579744, -0.59449440, -0.67768276, 0.68781549, 1.46728075, 1.68877220, 1.56133235, -2.00056386],
    [ 0.23341942, -0.82390147, -0.79098356, 0.56039596, -0.61123407, 1.91687596, -0.74604672, 1.64497244, -1.10399675, -0.11699112],
    [ -0.93294680, -0.34403381, -2.37116241, -1.43796575, -0.08516861, 1.09313345, 1.11867619, -0.09029349, -1.08179951, -0.53231722],
    [ -0.06327412, 0.07424675, -1.81953967, 0.30803666, 2.24175096, 0.10310568, -0.70534545, -0.76693177, 1.55273652, -1.04003561]
]
var bias4 = [[0.26023, -0.54600, -1.69065, 0.64599, -1.48815, -0.30396, 1.30466, 0.72157, -0.11983, -0.32053]  ]
  
    
    var network = []
    network.push(new InputLayer());
    network.push(new ConvFM(weights1, bias1));
    network.push(new MaxPool2D());
    network.push(new ConvFM(weights2, bias2));
    network.push(new Flatten());
    network.push(new FullyConnected(weights3, bias3));
    network.push(new FullyConnected(weights4, bias4));
    network.push(new QuadraticCostLayer());    
    

    exec("MNIST_conv_TF", network, input, output, 0.2718303)
}

function regressionTests()
{
    Train_Conv2D_TF_flatten(TestResult); //ok

    Train_Conv2D_LY_1_FM_1_TF(TestResult); //ok
    Train_Conv2D_LY_2_FM_1_TF(TestResult);  //ok
    
    Train_Conv2D_LY_1_FM_12_TF(TestResult); //no FM for 2D convolutions, only 3D
    
    Train_Conv2D_LY_1_FM_21_TF(TestResult); //ok    
    Train_Conv2D_LY_1_FM_22_TF(TestResult); //ok
    Train_Conv2D_LY_2_FM_22_TF(TestResult)
    Train_Conv2D_LY_1_3x4_FM_22_TF(TestResult); //ok
    Train_Conv2D_LY_1_3x4_FM_21_TF(TestResult); //ok
    
    Train_Conv3D_TF_flatten(TestResult); 
}

function init()
{
    var myCanvas = document.getElementById("myCanvas");    
    
    //
    // Old stuff
    //
    
    //Train_XOR();
    //Test_Conv1DAndFullyConnected();
    // Test_LearnSin();
    //setInterval(iterate,10);
    //Test_Conv1D()
    //MaxPool1DTest()
    //ConvMaxPoolTest()
    //Test_FullyConnected_1(); //ok
    //Test_FullyConnected_2(); //ok
    //Test_Conv1DPool()
    //Test_Conv1DAndMaxPoolAndFullyConnected2();
    
    regressionTests()

    //
    // WIP
    //
    //MNIST_conv_TF(DebugResult);
    Train_Conv2D_LY_2_FM_24_TF(DebugResult); // not working!
}
</script>

<body onload="init()">
<h1>Neural network back prop using simple gradient descent, with matrix fomulation + bias for each layer</h1>
<div id="container">
<div id="text" ></div>
<canvas id="myCanvas" width="800" height="300"></canvas>
Let's consider a simple conv network an
d lets compute how to do back propagation on it. </br>
</br>
<h2>Contact/Questions:</h2>
 &lt;my_github_account_username&gt;$@gmail.com$.
</br>
</br>
</div>
</body>
</html>
